<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>GrapesJS Newsletter Editor</title>
    <link rel="stylesheet" href="//unpkg.com/grapesjs@0.14.57/dist/css/grapes.min.css">
    <link rel="stylesheet" href="https://grapesjs.com/stylesheets/material.css">
    <link rel="stylesheet" href="./style/tooltip.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <link rel="stylesheet" href="./dist/grapesjs-preset-newsletter.css">

    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="//unpkg.com/grapesjs@0.14.57/dist/grapes.min.js"></script>
    <script src="https://unpkg.com/grapesjs-parser-postcss"></script>
    <script src="https://grapesjs.com/js/grapesjs-preset-newsletter.min.js?v=0.2.15"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
  </head>
  <style>
    body, html{ height: 100%; margin: 0;}
  </style>
  <body>
    <div id="gjs" style="height:0px; overflow:hidden"></div>
    <script type="text/javascript">
      // Set up GrapesJS editor with the Newsletter plugin
      var editor = grapesjs.init({
        height: '100%',
        noticeOnUnload: 0,
        storageManager: { type: null },
        container : '#gjs',
        components: window.opener.mQuery('textarea.builder-html').val(),

        plugins: ['grapesjs-parser-postcss', 'gjs-preset-newsletter'],
        pluginsOpts: {
          'gjs-preset-newsletter': {
            modalLabelImport: 'Paste all your code here below and click import',
            modalLabelExport: 'Copy the code and use it wherever you want',
            codeViewerTheme: 'material',
            //defaultTemplate: templateImport,
            importPlaceholder: '',
            cellStyle: {
              'font-size': '12px',
              'font-weight': 300,
              'vertical-align': 'top',
              color: 'rgb(111, 119, 125)',
              margin: 0,
              padding: 0,
            }
          }
        }
      });

      editor.Panels.addButton('options',
          [{
              id: 'save',
              className: 'btn-alert-button',
              label: 'Save and close',
              command: function (editor1, sender) {
                  window.opener.mQuery('textarea.builder-html').val(editor.runCommand('gjs-get-inlined-html'));
                  window.close();
              },
              attributes: {title: 'Save and close'}
          }
       ]);

        editor.on('load',
            function() {
            //document.getElementsByClassName('btn-save-and-close')[0].innerHTML = "Save and close";
            });
      var pnm = editor.Panels;

      // Simple warn notifier
      var origWarn = console.warn;
      toastr.options = {
        closeButton: true,
        preventDuplicates: true,
        showDuration: 250,
        hideDuration: 150
      };
      console.warn = function (msg) {
        toastr.warning(msg);
        origWarn(msg);
      };

      $(document).ready(function () {

        // Beautify tooltips
        $('*[title]').each(function () {
          var el = $(this);
          var title = el.attr('title').trim();
          if(!title)
            {return;
}
          el.attr('data-tooltip', el.attr('title'));
          el.attr('title', '');
        });

      });
    </script>
  </body>
</html>
